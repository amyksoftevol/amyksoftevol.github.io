<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		body {
			color: #B3BFD0;
		}
		.container {
			background-color: #050D13;
			padding: 30px;
		}

		.btn-main, .btn-main:hover {
			background-color: #22CE9B;
			border-radius: 7px;
		}
		.btn-confirmation-no {
			background-color: #22CE9B;
		    border: 1px solid #22CE9B;
		    color: white;
		}

		.video-upload-header {
			box-shadow: inset 0 -1px 0 0 #222629;
			padding-left: 0;
			padding-right: 0;
		}
		.video-upload-header-limit {
			color: #879198;
		}

		.video-upload-row-head {
			box-shadow: inset 0 -1px 0 0 #222629;
			color: #879198;
		}
		.video-upload-row {
			box-shadow: inset 0 -1px 0 0 #222629;
		}
		.video-upload-row.error {
			background-color: transparent;;
		}
		.video-upload-cell-location {
			padding: 0;
		}

		.drag-and-drop-area-container {
			border: 2px dashed #53595D;
		    background: #091217;
		    border-radius: 7px;
		}
		.drag-and-drop-area-container.visible {
			background: #091217;
		}
		.drag-and-drop-area-text {
			color: #B3BFD0;
		}

		.confirmation-tooltip {
			background-color: #1D2429;
			border-radius: 7px;
			color: #BBC7D8;
			border: solid 1px #1D2429;
			box-shadow: none;
		}
		.confirmation-tooltip-top:before {
			border-color: #1D2429 transparent transparent transparent;
		}
		.confirmation-tooltip-top:after {
			border-color: #1D2429 transparent transparent transparent;

		}

	</style>
</head>
<body>

	<div style="width:100%;height:700px;margin:0 auto">
		<!-- <div style="text-align: center;">

			<button onclick="iframeUploader.chooseVideo()">Upload From Parent</button>
			<button onclick="iframeUploader.updateAuthToken('7777777777')">Update Auth Token</button>

		</div> -->
		<div id="iframeContainer" style="width:100%;height:100%;"></div>
	</div>
	<!-- <script src='https://dl.dropboxusercontent.com/s/fgt3pxdl3gulnw8/uploader.js'></script> -->

	<script>
		var IframeUploader = (function(window, undefined) {

			var IFRAME_SOURCE = 'iframeParent';
			// var IFRAME_SRC = 'http://dev.levelupmedia.tv/static/upload';
			var IFRAME_SRC = 'http://localhost:4200';
			// var IFRAME_ORIGIN = 'http://dev.levelupmedia.tv';
			var IFRAME_ORIGIN = 'http://localhost:4200';
			var iframeElement;
			var iframeOptions;

			function Message(messageType, options) {
				return {
					messageType: messageType,
					options: options
				}
			}

			function createIframeUploader(iframeContainerId, configuration) {
				setIframeUploaderOptions(configuration);
				var iframeContainer = document.getElementById(iframeContainerId)
				var iframe = document.createElement('iframe');
				iframe.src = IFRAME_SRC;
				iframe.frameBorder = '0';
				iframe.width = '100%';
				iframe.height = '100%';
				iframe.style.flexGrow = '1';
				iframe.onload = function() {
					iframeElement = iframe;
					configureIframeUploader();
				};
				iframeContainer.appendChild(iframe);
			}

			function setIframeUploaderOptions(configuration) {
				iframeOptions = configuration || {};
				iframeOptions.source = IFRAME_SOURCE;
			}

			function sendMessageToChildIframe(message) {
				iframeElement.contentWindow.postMessage(message, IFRAME_SRC);
			}

			function configureIframeUploader() {
				sendMessageToChildIframe(new Message('LOAD', iframeOptions));
			}

			function chooseVideo() {
				if (!iframeElement) {
					alert('Iframe isn\'t loaded...Please try again later!');
					return;
				}
				sendMessageToChildIframe(new Message('CHOOSE_VIDEO', iframeOptions));
			}

			function updateAuthToken(authToken) {
				iframeOptions.authToken = authToken;
				sendMessageToChildIframe(new Message('UPDATE_AUTH_TOKEN', iframeOptions));
			}

			function sendMessageToIframeParent(messageData) {
				var event = new CustomEvent('iframeMessage', {detail: messageData});
				window.dispatchEvent(event);
			}

			window.addEventListener('message', function(event) {
				if (event.origin !== IFRAME_ORIGIN) return;
				var messageData = JSON.parse(event.data);
				sendMessageToIframeParent(messageData);
			});

			return {
				chooseVideo: chooseVideo,
				createIframeUploader: createIframeUploader,
				updateAuthToken: updateAuthToken
			}

		}(window));
	</script>

	<script>
		var style = document.getElementsByTagName('style')[0].innerText;

		var config = {
			authToken: "",
			cssEmbedded: style,
			// cssExternal: "https://dl.dropbox.com/s/khutet5bmu9bl7w/styles.css"
		};
		IframeUploader.createIframeUploader('iframeContainer', config);
		window.addEventListener("iframeMessage", function(event) {
		  console.log('CUSTOM EVENT', event);
		  console.log('Message from CHILD: ', event.detail);
		});

	</script>
	
</body>
</html>