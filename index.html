<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>

	<div style="width:600px;margin:0 auto">
		<div style="text-align: center;">

			<button onclick="iframeUploader.uploadVideo()">Upload From Parent</button>

		</div>
		<div id="iframeContainer" style="width:400px;height:400px;margin:0 auto"></div>
	</div>

	<script>
		var iframeUploader = (function() {

			// listen events from child
			window.addEventListener('message', event => {
				console.log('Message from CHILD: ', event);
			});

			var iframeElement;
			var iframeOptions = {};
			var iframeSrc = 'https://iframeuploader.herokuapp.com/';

			function createIframeUploader(iframeContainerId, configuration) {
				setIframeUploaderOptions(configuration);
				var iframeContainer = document.getElementById(iframeContainerId)
				var iframe = document.createElement('iframe');
				iframe.src = iframeSrc;
				iframe.frameborder = '1';
				iframe.width = '100%';
				iframe.height = '100%';
				iframe.onload = function() {
					iframeElement = iframe;
					// configure iframe uploader
					sendMessageToChildIframe(iframeElement);
				};
				iframeContainer.appendChild(iframe);
			}

			function setIframeUploaderOptions(configuration) {
				iframeOptions = configuration;
				Object.defineProperty(iframeOptions, 'source', {
					value: 'iframeParent',
					writable: false
				});
			}

			function sendMessageToChildIframe(iframeEl) {
				console.log('sendMessageToChildIframe', iframeEl);
				iframeEl.contentWindow.postMessage(iframeOptions, "*");
			}

			function uploadVideo() {
				if (!iframeElement) {
					alert('Iframe is still loading...Please try again later!');
					return;
				}
				sendMessageToChildIframe(iframeElement);
			}

			return {
				uploadVideo: uploadVideo,
				createIframeUploader: createIframeUploader
			}
		}());
	</script>

	<script>
		var config = {
			authToken: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJlbWFpbCIsInN1YiI6IjY3MiIsImlhdCI6MTU0MzQ5MjEzOCwiZXhwIjoxNTQ0MDk2OTM4fQ.0QA-IznaT6KvJMuwxAZNa5Wi7PBCLVibe3eoYUc26rg",
			cssEmbedded: ".title{color:#FFF;background-color:#BAAFD5;} .button{background-color:#13b49f;font-size:14px;color:#FFF;font-weight:500;}",
			cssExternal: "https://dl.dropbox.com/s/khutet5bmu9bl7w/styles.css"
		};
		iframeUploader.createIframeUploader('iframeContainer', config);
	</script>
	
</body>
</html>